# ================================================
# üí¨ WORKFLOW: Discord: CI-Alerts + Demo
# ================================================
# Dieser Workflow kann zwei Dinge:
# 1Ô∏è‚É£ Manuell gestartet werden (Demo im Unterricht)
# 2Ô∏è‚É£ Automatisch eine Nachricht schicken, wenn andere Workflows fehlschlagen
# ================================================
# -> Das ist der Name, der im "Actions"-Tab angezeigt wird
name: Demo-Discord-Notify (Test)


# ================================================
# üìÖ TRIGGER - Wann wird dieser Workflow gestartet?
# ================================================
on:
  # 1Ô∏è‚É£ workflow_dispatch = Knopf im GitHub Actions Tab (manuell starten)
  workflow_dispatch:
    inputs: # -> Damit kann man Eingaben machen, wenn man den Knopf dr√ºckt
      as:
        description: "Wie soll die Demo-Nachricht aussehen?"  # Erkl√§rtext im Auswahlmen√º
        required: true              # Muss ausgew√§hlt werden
        default: "test"             # Standardwert, falls man nichts ausw√§hlt
        type: choice                # Wir machen eine kleine Auswahl-Liste
        options:                    # Diese Auswahlpunkte erscheinen in GitHub
          - test     # neutrale Test-Nachricht
          - fail     # Demo eines Fehlers
          - success  # Demo eines erfolgreichen Laufs
      note:
        description: "Optionaler Zusatztext in der Demo-Nachricht"
        required: false
        default: ""
        type: string

  # 2Ô∏è‚É£ workflow_run = Wird gestartet, wenn andere Workflows fertig sind
  workflow_run:
    # Hier schreiben wir die Namen der Workflows, die √ºberwacht werden sollen.
    workflows: ["Java Matrix Build", "Simple Java CI", "Python Matrix Build", "Simple Python CI"]
    types: [completed]  # -> Das bedeutet: Es wird ausgel√∂st, wenn sie fertig sind (egal ob Erfolg oder Fehler)

# ================================================
# ‚öôÔ∏è JOBS - Was dieser Workflow tun soll
# ================================================
jobs:
  discord-notify:           # <- Name des Jobs (frei w√§hlbar)
    runs-on: ubuntu-latest  # -> Das ist das Betriebssystem, auf dem GitHub den Code ausf√ºhrt (eine virtuelle Linux-Maschine)

    steps:  # -> Jeder Job besteht aus Schritten, die nacheinander ausgef√ºhrt werden
      # ======================================================
      # üß™ 1. DEMO-NACHRICHT PER KNOPFDRUCK (workflow_dispatch)
      # ======================================================

      # --- Schritt 1: Neutrale Testnachricht ---
      - name: Demo:neutrale Test-Nachricht
        # "if" bedeutet: f√ºhre diesen Schritt nur aus, wenn diese Bedingung stimmt
        # Hier: Nur wenn der Workflow per Knopfdruck gestartet wurde UND die Auswahl "test" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0  # -> Wir nutzen eine vorgefertigte Action, die eine Discord-Nachricht senden kann
        with:  # -> Hier geben wir die Eingaben (Inputs) f√ºr die Action an
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}  # -> Holt die Webhook-URL aus den GitHub Secrets (nie direkt in Code schreiben!)
          content: |  # -> Der Inhalt der Nachricht (einfacher Text)
            üõ†Ô∏è **Webhook-Test (manuell)**
            üì¶ Repo: ${{ github.repository }}
            üë§ Ausgel√∂st von: ${{ github.actor }}
            ‚ñ∂Ô∏è Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}

      # --- Schritt 2: Demo im Fehler-Stil ---
      - name: Demo:Fehler-Stil
        # Nur ausf√ºhren, wenn per Knopfdruck gestartet wurde und die Auswahl "fail" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Hier senden wir eine sogenannte "Embed"-Nachricht.
          # Das ist eine sch√∂n formatierte Karte in Discord.
          embed-title: "‚ùå DEMO ‚Äî CI fehlgeschlagen"
          embed-description: |  # -> Mehrzeiliger Text, der im Embed angezeigt wird
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 15548997  # -> Farbe des Embeds (rot)

      # --- Schritt 3: Demo im Erfolgs-Stil ---
      - name: Demo:Erfolgs-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚úÖ DEMO ‚Äî CI erfolgreich"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 5763719  # -> gr√ºn

      # ======================================================
      # ‚ö†Ô∏è 2. AUTOMATISCHE MELDUNG BEI FEHLER (workflow_run)
      # ======================================================

      - name: CI-Fehler melden (nur bei Misserfolg)
        # Diese Bedingung pr√ºft:
        # 1Ô∏è‚É£ wurde der Workflow von einem anderen Workflow ausgel√∂st (workflow_run)?
        # 2Ô∏è‚É£ ist dessen Ergebnis NICHT "success" (also failed oder cancelled)?
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Titel des Discord-Embeds
          embed-title: "‚ùå CI fehlgeschlagen ‚Äî ${{ github.event.workflow_run.name }}"
          # Beschreibung mit Infos √ºber das Repository und den fehlgeschlagenen Lauf
          embed-description: |
            **Repo:**   ${{ github.repository }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Commit:** ${{ github.event.workflow_run.head_sha }}
            **Run:**    ${{ github.event.workflow_run.html_url }}
          # Farbe = Rot (Discord erwartet eine Zahl)
          embed-color: 15548997
# ================================================
# üí¨ WORKFLOW: Discord: CI-Alerts + Demo
# ================================================
# Dieser Workflow kann zwei Dinge:
# 1Ô∏è‚É£ Manuell gestartet werden (Demo im Unterricht)
# 2Ô∏è‚É£ Automatisch eine Nachricht schicken, wenn andere Workflows fehlschlagen
# ================================================

name: Discord: CI-Alerts + Demo  # -> Das ist der Name, der im "Actions"-Tab angezeigt wird

# ================================================
# üìÖ TRIGGER - Wann wird dieser Workflow gestartet?
# ================================================
on:
  # 1Ô∏è‚É£ workflow_dispatch = Knopf im GitHub Actions Tab (manuell starten)
  workflow_dispatch:
    inputs: # -> Damit kann man Eingaben machen, wenn man den Knopf dr√ºckt
      as:
        description: "Wie soll die Demo-Nachricht aussehen?"  # Erkl√§rtext im Auswahlmen√º
        required: true              # Muss ausgew√§hlt werden
        default: "test"             # Standardwert, falls man nichts ausw√§hlt
        type: choice                # Wir machen eine kleine Auswahl-Liste
        options:                    # Diese Auswahlpunkte erscheinen in GitHub
          - test     # neutrale Test-Nachricht
          - fail     # Demo eines Fehlers
          - success  # Demo eines erfolgreichen Laufs
      note:
        description: "Optionaler Zusatztext in der Demo-Nachricht"
        required: false
        default: ""
        type: string

  # 2Ô∏è‚É£ workflow_run = Wird gestartet, wenn andere Workflows fertig sind
  workflow_run:
    # Hier schreiben wir die Namen der Workflows, die √ºberwacht werden sollen.
    workflows: ["java-matrix", "java-simple", "python-matrix", "python-simple"]
    types: [completed]  # -> Das bedeutet: Es wird ausgel√∂st, wenn sie fertig sind (egal ob Erfolg oder Fehler)

# ================================================
# ‚öôÔ∏è JOBS - Was dieser Workflow tun soll
# ================================================
jobs:
  discord-notify:           # <- Name des Jobs (frei w√§hlbar)
    runs-on: ubuntu-latest  # -> Das ist das Betriebssystem, auf dem GitHub den Code ausf√ºhrt (eine virtuelle Linux-Maschine)

    steps:  # -> Jeder Job besteht aus Schritten, die nacheinander ausgef√ºhrt werden
      # ======================================================
      # üß™ 1. DEMO-NACHRICHT PER KNOPFDRUCK (workflow_dispatch)
      # ======================================================

      # --- Schritt 1: Neutrale Testnachricht ---
      - name: Demo: neutrale Test-Nachricht
        # "if" bedeutet: f√ºhre diesen Schritt nur aus, wenn diese Bedingung stimmt
        # Hier: Nur wenn der Workflow per Knopfdruck gestartet wurde UND die Auswahl "test" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0  # -> Wir nutzen eine vorgefertigte Action, die eine Discord-Nachricht senden kann
        with:  # -> Hier geben wir die Eingaben (Inputs) f√ºr die Action an
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}  # -> Holt die Webhook-URL aus den GitHub Secrets (nie direkt in Code schreiben!)
          content: |  # -> Der Inhalt der Nachricht (einfacher Text)
            üõ†Ô∏è **Webhook-Test (manuell)**
            üì¶ Repo: ${{ github.repository }}
            üë§ Ausgel√∂st von: ${{ github.actor }}
            ‚ñ∂Ô∏è Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}

      # --- Schritt 2: Demo im Fehler-Stil ---
      - name: Demo: Fehler-Stil
        # Nur ausf√ºhren, wenn per Knopfdruck gestartet wurde und die Auswahl "fail" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Hier senden wir eine sogenannte "Embed"-Nachricht.
          # Das ist eine sch√∂n formatierte Karte in Discord.
          embed-title: "‚ùå DEMO ‚Äî CI fehlgeschlagen"
          embed-description: |  # -> Mehrzeiliger Text, der im Embed angezeigt wird
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 15548997  # -> Farbe des Embeds (rot)

      # --- Schritt 3: Demo im Erfolgs-Stil ---
      - name: Demo: Erfolgs-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚úÖ DEMO ‚Äî CI erfolgreich"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 5763719  # -> gr√ºn

      # ======================================================
      # ‚ö†Ô∏è 2. AUTOMATISCHE MELDUNG BEI FEHLER (workflow_run)
      # ======================================================

      - name: CI-Fehler melden (nur bei Misserfolg)
        # Diese Bedingung pr√ºft:
        # 1Ô∏è‚É£ wurde der Workflow von einem anderen Workflow ausgel√∂st (workflow_run)?
        # 2Ô∏è‚É£ ist dessen Ergebnis NICHT "success" (also failed oder cancelled)?
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Titel des Discord-Embeds
          embed-title: "‚ùå CI fehlgeschlagen ‚Äî ${{ github.event.workflow_run.name }}"
          # Beschreibung mit Infos √ºber das Repository und den fehlgeschlagenen Lauf
          embed-description: |
            **Repo:**   ${{ github.repository }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Commit:** ${{ github.event.workflow_run.head_sha }}
            **Run:**    ${{ github.event.workflow_run.html_url }}
          # Farbe = Rot (Discord erwartet eine Zahl)
          embed-color: 15548997
# ================================================
# üí¨ WORKFLOW: Discord: CI-Alerts + Demo
# ================================================
# Dieser Workflow kann zwei Dinge:
# 1Ô∏è‚É£ Manuell gestartet werden (Demo im Unterricht)
# 2Ô∏è‚É£ Automatisch eine Nachricht schicken, wenn andere Workflows fehlschlagen
# ================================================

name: Discord: CI-Alerts + Demo  # -> Das ist der Name, der im "Actions"-Tab angezeigt wird

# ================================================
# üìÖ TRIGGER - Wann wird dieser Workflow gestartet?
# ================================================
on:
  # 1Ô∏è‚É£ workflow_dispatch = Knopf im GitHub Actions Tab (manuell starten)
  workflow_dispatch:
    inputs: # -> Damit kann man Eingaben machen, wenn man den Knopf dr√ºckt
      as:
        description: "Wie soll die Demo-Nachricht aussehen?"  # Erkl√§rtext im Auswahlmen√º
        required: true              # Muss ausgew√§hlt werden
        default: "test"             # Standardwert, falls man nichts ausw√§hlt
        type: choice                # Wir machen eine kleine Auswahl-Liste
        options:                    # Diese Auswahlpunkte erscheinen in GitHub
          - test     # neutrale Test-Nachricht
          - fail     # Demo eines Fehlers
          - success  # Demo eines erfolgreichen Laufs
      note:
        description: "Optionaler Zusatztext in der Demo-Nachricht"
        required: false
        default: ""
        type: string

  # 2Ô∏è‚É£ workflow_run = Wird gestartet, wenn andere Workflows fertig sind
  workflow_run:
    # Hier schreiben wir die Namen der Workflows, die √ºberwacht werden sollen.
    workflows: ["java-matrix", "java-simple", "python-matrix", "python-simple"]
    types: [completed]  # -> Das bedeutet: Es wird ausgel√∂st, wenn sie fertig sind (egal ob Erfolg oder Fehler)

# ================================================
# ‚öôÔ∏è JOBS - Was dieser Workflow tun soll
# ================================================
jobs:
  discord-notify:           # <- Name des Jobs (frei w√§hlbar)
    runs-on: ubuntu-latest  # -> Das ist das Betriebssystem, auf dem GitHub den Code ausf√ºhrt (eine virtuelle Linux-Maschine)

    steps:  # -> Jeder Job besteht aus Schritten, die nacheinander ausgef√ºhrt werden
      # ======================================================
      # üß™ 1. DEMO-NACHRICHT PER KNOPFDRUCK (workflow_dispatch)
      # ======================================================

      # --- Schritt 1: Neutrale Testnachricht ---
      - name: Demo: neutrale Test-Nachricht
        # "if" bedeutet: f√ºhre diesen Schritt nur aus, wenn diese Bedingung stimmt
        # Hier: Nur wenn der Workflow per Knopfdruck gestartet wurde UND die Auswahl "test" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0  # -> Wir nutzen eine vorgefertigte Action, die eine Discord-Nachricht senden kann
        with:  # -> Hier geben wir die Eingaben (Inputs) f√ºr die Action an
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}  # -> Holt die Webhook-URL aus den GitHub Secrets (nie direkt in Code schreiben!)
          content: |  # -> Der Inhalt der Nachricht (einfacher Text)
            üõ†Ô∏è **Webhook-Test (manuell)**
            üì¶ Repo: ${{ github.repository }}
            üë§ Ausgel√∂st von: ${{ github.actor }}
            ‚ñ∂Ô∏è Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}

      # --- Schritt 2: Demo im Fehler-Stil ---
      - name: Demo: Fehler-Stil
        # Nur ausf√ºhren, wenn per Knopfdruck gestartet wurde und die Auswahl "fail" war
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Hier senden wir eine sogenannte "Embed"-Nachricht.
          # Das ist eine sch√∂n formatierte Karte in Discord.
          embed-title: "‚ùå DEMO ‚Äî CI fehlgeschlagen"
          embed-description: |  # -> Mehrzeiliger Text, der im Embed angezeigt wird
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 15548997  # -> Farbe des Embeds (rot)

      # --- Schritt 3: Demo im Erfolgs-Stil ---
      - name: Demo: Erfolgs-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.as == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚úÖ DEMO ‚Äî CI erfolgreich"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 5763719  # -> gr√ºn

      # ======================================================
      # ‚ö†Ô∏è 2. AUTOMATISCHE MELDUNG BEI FEHLER (workflow_run)
      # ======================================================

      - name: CI-Fehler melden (nur bei Misserfolg)
        # Diese Bedingung pr√ºft:
        # 1Ô∏è‚É£ wurde der Workflow von einem anderen Workflow ausgel√∂st (workflow_run)?
        # 2Ô∏è‚É£ ist dessen Ergebnis NICHT "success" (also failed oder cancelled)?
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          # Titel des Discord-Embeds
          embed-title: "‚ùå CI fehlgeschlagen ‚Äî ${{ github.event.workflow_run.name }}"
          # Beschreibung mit Infos √ºber das Repository und den fehlgeschlagenen Lauf
          embed-description: |
            **Repo:**   ${{ github.repository }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Commit:** ${{ github.event.workflow_run.head_sha }}
            **Run:**    ${{ github.event.workflow_run.html_url }}
          # Farbe = Rot (Discord erwartet eine Zahl)
          embed-color: 15548997
