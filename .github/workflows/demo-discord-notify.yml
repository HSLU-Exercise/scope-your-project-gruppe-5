name: Discord Alerts (Demo)

on:
  workflow_dispatch:
    inputs:
      mode:
        description: "Mode: test or fail or success"
        required: true
        default: "test"
      note:
        description: "Optional note"
        required: false
        default: ""
  workflow_run:
    workflows:
      - "Java Matrix Build"
      - "Simple Java CI"
      - "Python Matrix Build"
      - "Simple Python CI"
    types: completed

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # Neutral test message (blue embed)
      - name: Demo test message
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "CI Notifier"
          embed-title: "ℹ️ Webhook Test"
          embed-url: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: "Repository: `${{ github.repository }}`  \nRun: [Open Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})  \nNote: `${{ github.event.inputs.note }}`"
          embed-color: 3447003  # blue

      # Failure-style demo (red embed)
      - name: Demo fail style
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "CI Notifier"
          embed-title: "❌ DEMO - CI failed"
          embed-url: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: "Repo: `${{ github.repository }}`  \nBranch: `${{ github.ref_name }}`  \nCommit: `${{ github.sha }}`  \n[Open Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})  \nNote: `${{ github.event.inputs.note }}`"
          embed-color: 15548997  # red

      # Success-style demo (green embed)
      - name: Demo success style
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "CI Notifier"
          embed-title: "✅ DEMO - CI success"
          embed-url: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: "Repo: `${{ github.repository }}`  \nBranch: `${{ github.ref_name }}`  \nCommit: `${{ github.sha }}`  \n[Open Run](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})  \nNote: `${{ github.event.inputs.note }}`"
          embed-color: 5763719  # green

      # Automatic alert on failure of monitored workflows
      - name: Auto alert on failure
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "CI Notifier"
          embed-title: "❌ CI failed - ${{ github.event.workflow_run.name }}"
          embed-url: "${{ github.event.workflow_run.html_url }}"
          embed-description: "Repository: `${{ github.repository }}`  \nBranch: `${{ github.event.workflow_run.head_branch }}`  \nCommit: `${{ github.event.workflow_run.head_sha }}`  \n[Open Run](${{ github.event.workflow_run.html_url }})  \n> Please review the logs in the Actions run."
          embed-color: 15548997  # red
