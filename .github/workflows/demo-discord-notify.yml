# =========================================================
# Discord: CI-Alerts + Demo (Kombiniert)
# - Knopf f√ºr Demo (workflow_dispatch)
# - Automatische Meldung, wenn √ºberwachte Workflows scheitern (workflow_run)
# =========================================================

name: "Discord: CI-Alerts + Demo"

on:
  # Knopf im Actions-Tab
  workflow_dispatch:
    inputs:
      mode:
        description: "Demo-Modus: test | fail | success"
        required: true
        default: "test"
      note:
        description: "Optionaler Kommentar"
        required: false
        default: ""

  # Beobachte die **Namen** deiner Workflows (m√ºssen exakt matchen)
  workflow_run:
    workflows: ["Java Matrix Build", "Simple Java CI", "Python Matrix Build", "Simple Python CI"]
    types: [completed]

jobs:
  discord-notify:
    runs-on: ubuntu-latest

    steps:
      # -------------------------------
      # Demo per Knopfdruck
      # -------------------------------

      - name: Demo: neutrale Test-Nachricht
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          content: |
            üõ†Ô∏è **Webhook-Test (manuell)**
            üì¶ Repo: ${{ github.repository }}
            üë§ Ausgel√∂st von: ${{ github.actor }}
            ‚ñ∂Ô∏è Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}

      - name: Demo: Fehler-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚ùå DEMO ‚Äî CI fehlgeschlagen"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 15548997

      - name: Demo: Erfolgs-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚úÖ DEMO ‚Äî CI erfolgreich"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 5763719

      # -------------------------------
      # Auto-Alarm bei Fehlern
      # -------------------------------

      - name: CI-Fehler melden (nur wenn != success)
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_Webhook || secrets.DISCORD_WEBHOOK }}
          embed-title: "‚ùå CI fehlgeschlagen ‚Äî ${{ github.event.workflow_run.name }}"
          embed-description: |
            **Repo:**   ${{ github.repository }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Commit:** ${{ github.event.workflow_run.head_sha }}
            **Run:**    ${{ github.event.workflow_run.html_url }}
          embed-color: 15548997
# =========================================================
# Discord: CI-Alerts + Demo (Kombiniert)
# - Knopf f√ºr Demo (workflow_dispatch)
# - Automatische Meldung, wenn √ºberwachte Workflows scheitern (workflow_run)
# =========================================================

name: Discord: CI-Alerts + Demo

on:
  # Knopf im Actions-Tab
  workflow_dispatch:
    inputs:
      mode:
        description: "Demo-Modus: test | fail | success"
        required: true
        default: "test"
      note:
        description: "Optionaler Kommentar"
        required: false
        default: ""

  # Beobachte die **Namen** deiner Workflows (m√ºssen exakt matchen)
  workflow_run:
    workflows: ["Java Matrix Build", "Simple Java CI", "Python Matrix Build", "Simple Python CI"]
    types: [completed]

jobs:
  discord-notify:
    runs-on: ubuntu-latest

    steps:
      # -------------------------------
      # Demo per Knopfdruck
      # -------------------------------

      - name: Demo: neutrale Test-Nachricht
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'test' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          content: |
            üõ†Ô∏è **Webhook-Test (manuell)**
            üì¶ Repo: ${{ github.repository }}
            üë§ Ausgel√∂st von: ${{ github.actor }}
            ‚ñ∂Ô∏è Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}

      - name: Demo: Fehler-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'fail' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚ùå DEMO ‚Äî CI fehlgeschlagen"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 15548997

      - name: Demo: Erfolgs-Stil
        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.mode == 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embed-title: "‚úÖ DEMO ‚Äî CI erfolgreich"
          embed-description: |
            **Repo:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** ${{ github.sha }}
            **Run:** ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            üí¨ ${{ github.event.inputs.note }}
          embed-color: 5763719

      # -------------------------------
      # Auto-Alarm bei Fehlern
      # -------------------------------

      - name: CI-Fehler melden (nur wenn != success)
        if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion != 'success' }}
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.Discord_Webhook || secrets.DISCORD_WEBHOOK }}
          embed-title: "‚ùå CI fehlgeschlagen ‚Äî ${{ github.event.workflow_run.name }}"
          embed-description: |
            **Repo:**   ${{ github.repository }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Commit:** ${{ github.event.workflow_run.head_sha }}
            **Run:**    ${{ github.event.workflow_run.html_url }}
          embed-color: 15548997
